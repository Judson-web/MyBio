<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Judson Saji - Creator</title>
  <meta name="description" content="ExPoet, ExMinimalist, ExThinker, NowCreator" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="https://firebasestorage.googleapis.com/v0/b/crnn-b7d8f.appspot.com/o/files%2FIMG_20250717_215454_617-modified.png?alt=media&token=bea1f0dd-abf1-4cfb-8a83-0d3b603d3fde" />
  
  <!-- Pre-connect and Preload for performance -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://unpkg.com">
  <link rel="preconnect" href="https://cdnjs.cloudflare.com">
  <link rel="preconnect" href="https://cdn.jsdelivr.net">

  <link rel="preload" href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Fira+Code:wght@400&display=swap" as="style">
  <link rel="preload" href="https://unpkg.com/feather-icons" as="script">
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js" as="script">
  <link rel="preload" href="https://cdn.jsdelivr.net/npm/marked/marked.min.js" as="script">

  <!-- Social Media Meta Tags -->
  <meta property="og:title" content="Judson Saji - Creator" />
  <meta property="og:description" content="ExPoet, ExMinimalist, ExThinker, NowCreator" />
  <meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/crnn-b7d8f.appspot.com/o/files%2FIMG_20250717_215454_617-modified.png?alt=media&token=bea1f0dd-abf1-4cfb-8a83-0d3b603d3fde" />
  <meta property="og:url" content="https://judsonsaji.netlify.app/" />
  <meta property="og:type" content="website" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Judson Saji - Creator" />
  <meta name="twitter:description" content="ExPoet, ExMinimalist, ExThinker, NowCreator" />
  <meta name="twitter:image" content="https://firebasestorage.googleapis.com/v0/b/crnn-b7d8f.appspot.com/o/files%2FIMG_20250717_215454_617-modified.png?alt=media&token=bea1f0dd-abf1-4cfb-8a83-0d3b603d3fde" />

  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Fira+Code:wght@400&display=swap" rel="stylesheet" />
  <script src="https://unpkg.com/feather-icons"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  
  <!-- SEO Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Person",
    "name": "Judson Saji",
    "url": "https://judsonsaji.netlify.app/",
    "image": "https://firebasestorage.googleapis.com/v0/b/crnn-b7d8f.appspot.com/o/files%2FIMG_20250717_215454_617-modified.png?alt=media&token=bea1f0dd-abf1-4cfb-8a83-0d3b603d3fde",
    "sameAs": [
      "https://twitter.com/greyvrita",
      "https://github.com/Judson-web",
      "https://www.instagram.com/judson_saji"
    ],
    "jobTitle": "Creator",
    "description": "ExPoet, ExMinimalist, ExThinker, NowCreator"
  }
  </script>

  <style>
    /* --- THEME VARIABLES --- */
    :root {
      --bg-color: #0a0a0f;
      --text-color: #e0e0e0;
      --dim-text-color: #a0a0a0;
      --card-bg: rgba(255, 255, 255, 0.05);
      --card-border: rgba(255, 255, 255, 0.15);
      --card-shadow: rgba(0, 0, 0, 0.37);
      --header-bg: rgba(10, 10, 15, 0.5);
      --glow-color-1: #38e7ff;
      --glow-color-2: #ff73fa;
      --success-color: #50fa7b;
      --error-color: #ff5555;
    }

    .light-theme {
      --bg-color: #f4f5f7;
      --text-color: #1a1a1a;
      --dim-text-color: #5a5a5a;
      --card-bg: rgba(255, 255, 255, 0.6);
      --card-border: rgba(0, 0, 0, 0.1);
      --card-shadow: rgba(99, 99, 99, 0.1) 0px 4px 12px 0px;
      --header-bg: rgba(255, 255, 255, 0.7);
      --glow-color-1: #007BFF;
      --glow-color-2: #e83e8c;
      --success-color: #28a745;
      --error-color: #dc3545;
    }

    /* --- GENERAL STYLES --- */
    html, body {
      margin: 0;
      padding: 0;
      font-family: "DM Sans", sans-serif;
      background: var(--bg-color);
      color: var(--text-color);
      overflow-x: hidden;
      transition: background 0.4s ease, color 0.4s ease;
      box-sizing: border-box; /* Ensure padding/border included in element's total width/height */
    }
    *, *::before, *::after {
        box-sizing: inherit; /* Inherit box-sizing for all elements */
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .spin {
      animation: spin 1.5s linear infinite;
    }

    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 20px -10px var(--glow-color-1); }
      50% { box-shadow: 0 0 20px 0px var(--glow-color-1); }
    }

    /* --- PRELOADER --- */
    #preloader {
        position: fixed;
        top: 0; left: 0;
        width: 100vw; height: 100vh;
        background: var(--bg-color);
        z-index: 9999;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: opacity 0.5s ease;
    }
    #preloader.loaded {
        opacity: 0;
        pointer-events: none;
    }

    /* --- Canvas Backgrounds --- */
    .background-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      pointer-events: none;
      transition: opacity 0.8s ease;
    }
    #aurora-canvas { opacity: 0; }
    #day-canvas { opacity: 0; }
    body:not(.light-theme) #aurora-canvas { opacity: 0.7; }
    .light-theme #day-canvas { opacity: 0.8; }
    #konami-canvas {
        z-index: 9997;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.5s ease;
    }
    #konami-canvas.active {
        opacity: 1;
    }

    /* Cursor Trail Canvas */
    #cursor-trail-canvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 998; /* Above background, below modals */
        pointer-events: none; /* Allows clicks to pass through */
        opacity: 0.7;
    }


    /* --- Header --- */
    .site-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: var(--header-bg);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      border-bottom: 1px solid var(--card-border);
      padding: 1rem 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 1000;
      transition: background 0.4s ease, border-color 0.4s ease;
      position: relative; /* Added for z-index context of hamburger */
    }

    .header-logo {
      font-size: 1.3rem;
      font-weight: 700;
      background: linear-gradient(90deg, var(--glow-color-1), var(--glow-color-2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      transition: text-shadow 0.3s ease;
      text-decoration: none; /* Ensure link doesn't have underline */
    }
    .header-logo:hover {
        text-shadow: 0 0 8px var(--glow-color-1);
    }

    .site-nav {
      display: flex; /* Default for desktop */
      gap: 0.5rem;
    }
    .site-nav a {
      color: var(--dim-text-color);
      text-decoration: none;
      font-weight: 500;
      padding: 0.5rem 0.75rem;
      border-radius: 8px;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .site-nav a:hover {
      background: rgba(127, 127, 127, 0.1);
      color: var(--text-color);
    }

    /* Hamburger Button */
    #hamburger-btn {
        display: none; /* Hidden by default on desktop */
        background: none;
        border: none;
        cursor: pointer;
        padding: 0.5rem;
        z-index: 1001; /* Above header nav */
        color: var(--text-color);
    }
    #hamburger-btn svg {
        width: 24px;
        height: 24px;
    }

    /* Main Navigation Drawer */
    #main-nav-drawer {
        position: fixed;
        top: 0;
        left: 0;
        width: 250px;
        height: 100%;
        background: var(--header-bg);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        z-index: 1000;
        transform: translateX(-100%);
        transition: transform 0.3s ease-out;
        box-shadow: 4px 0 15px rgba(0,0,0,0.3);
        display: flex;
        flex-direction: column;
    }
    #main-nav-drawer.active {
        transform: translateX(0);
    }
    #main-nav-drawer .drawer-header { /* NEW: Drawer Header Styling */
        padding: 1rem 1.5rem;
        border-bottom: 1px solid var(--card-border);
        display: flex;
        align-items: center;
        justify-content: space-between;
        min-height: 4rem; /* Match main header height */
    }
    #main-nav-drawer .drawer-header .header-logo {
        font-size: 1.3rem; /* Match main header logo size */
    }
    #main-nav-drawer .drawer-nav-links {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        padding: 1rem;
        flex-grow: 1; /* Allow links to take available space */
    }
    #main-nav-drawer .drawer-nav-links a {
        color: var(--text-color);
        text-decoration: none;
        padding: 0.75rem 1rem;
        border-radius: 8px;
        transition: all 0.2s ease;
        font-weight: 500;
    }
    #main-nav-drawer .drawer-nav-links a:hover {
        background: rgba(127, 127, 127, 0.15);
        color: var(--glow-color-1);
    }
    /* Drawer close button */
    #drawer-close-btn {
        background: none;
        border: none;
        cursor: pointer;
        padding: 0.5rem;
        color: var(--text-color);
    }
    #drawer-close-btn svg {
        width: 24px;
        height: 24px;
    }

    /* Drawer backdrop */
    #drawer-backdrop {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        z-index: 999;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    #drawer-backdrop.active {
        opacity: 1;
        visibility: visible;
    }


    /* Media Queries for Responsive Navigation */
    @media (max-width: 768px) {
        .site-nav {
            display: none; /* Hide desktop nav */
        }
        #hamburger-btn {
            display: block; /* Show hamburger */
        }
    }


    /* --- Main Content --- */
    .centerbox {
      position: relative;
      z-index: 1;
      min-height: 100vh;
      padding: 8rem 1.5rem 4rem;
      box-sizing: border-box;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      perspective: 1000px;
    }

    .card {
      background: var(--card-bg);
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      border-radius: 20px;
      border:1px solid var(--card-border);
      box-shadow: var(--card-shadow);
      padding: 2.5rem 1.5rem 2rem;
      max-width: 420px;
      width: 100%;
      box-sizing: border-box;
      transition: transform 0.1s ease-out, background 0.4s ease, border-color 0.4s ease, box-shadow 0.4s ease;
      animation: pulse-glow 4s infinite ease-in-out;
    }

    .profile-img {
      width: 110px;
      height: 110px;
      border-radius: 50%;
      border: 3px solid rgba(127, 127, 127, 0.2);
      box-shadow: 0 0 24px rgba(0, 0, 0, 0.5);
      transition: transform 0.3s ease;
    }
    .profile-img:hover {
        transform: scale(1.05);
    }

    .profile-name {
      font-size: 2rem;
      font-weight: 700;
      margin: 1.25rem 0 0.25rem;
    }
    
    .profile-greeting {
        font-size: 1rem;
        color: var(--dim-text-color);
        margin-bottom: 0.5rem;
        min-height: 1.2em;
    }

    .profile-tagline {
      font-size: 1.1rem;
      color: var(--dim-text-color);
      margin-bottom: 1.5rem;
    }

    /* --- Status Widget --- */
    .status-widget {
        background: rgba(0,0,0,0.05);
        border-radius: 12px;
        padding: 0.6rem 1rem;
        margin: 0 auto 1.5rem;
        font-size: 0.9rem;
        color: var(--dim-text-color);
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        justify-content: center;
        gap: 1rem;
    }
    .status-widget i {
        width: 18px;
        height: 18px;
        transition: transform 0.3s ease-out; /* For subtle bounce */
    }

    /* --- Now Playing Widget --- */
    #now-playing-widget {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        background: rgba(0,0,0,0.05);
        border-radius: 12px;
        padding: 0.6rem 1rem;
        margin: 0 auto 1.5rem;
        font-size: 0.9rem;
        color: var(--dim-text-color);
        min-height: 48px; /* Ensure consistent height */
        box-sizing: border-box;
        transition: all 0.3s ease;
    }
    #now-playing-widget.loading {
        opacity: 0.7;
    }
    #now-playing-widget .album-art {
        width: 36px;
        height: 36px;
        border-radius: 6px;
        object-fit: cover;
        box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }
    #now-playing-widget .track-info {
        display: flex;
        flex-direction: column;
        text-align: left;
        flex-grow: 1;
        min-width: 0; /* Allow text ellipsis */
    }
    #now-playing-widget .track-name {
        color: var(--text-color);
        font-weight: 600;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    #now-playing-widget .artist-name {
        color: var(--dim-text-color);
        font-size: 0.8em;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    #now-playing-widget .no-track {
        color: var(--dim-text-color);
        font-style: italic;
    }


    /* --- Buttons --- */
    .btn-group {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .ambient-btn {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0.9rem 1.25rem;
      font-size: 1rem;
      font-weight: 600;
      border-radius: 12px;
      background: rgba(127, 127, 127, 0.1);
      border: 1px solid rgba(127, 127, 127, 0.2);
      color: var(--text-color);
      text-decoration: none;
      backdrop-filter: blur(12px);
      transition: all 0.3s ease, box-shadow 0.3s ease; /* Added box-shadow to transition */
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); /* Initial subtle shadow */
    }

    /* Enhanced hover effects */
    .ambient-btn:hover {
      background: rgba(127, 127, 127, 0.2);
      border-color: var(--glow-color-1);
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.2), 0 0 20px var(--glow-color-1); /* Stronger shadow */
      transform: translateY(-3px) scale(1.01); /* Slight lift and scale */
    }
    
    .ambient-btn:nth-child(2):hover {
       border-color: var(--glow-color-2);
       box-shadow: 0 4px 24px rgba(0, 0, 0, 0.2), 0 0 20px var(--glow-color-2);
    }
    /* For buttons inside modals, like generate-thought-btn */
    .modal-content .ambient-btn:hover {
        border-color: var(--glow-color-1); /* Consistent glow for all AI buttons */
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.2), 0 0 20px var(--glow-color-1);
    }


    .ambient-btn svg {
      margin-right: 10px;
      stroke: var(--text-color);
      width: 22px;
      height: 22px;
      transition: transform 0.3s ease;
    }
    
    .ambient-btn:hover svg {
        transform: scale(1.1);
    }

    /* Glitch Effect */
    .glitch-effect {
        position: relative;
        overflow: hidden;
    }
    .glitch-effect:hover::before,
    .glitch-effect:hover::after {
        content: attr(data-text);
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: var(--card-bg);
        overflow: hidden;
        color: var(--glow-color-1);
        z-index: 1;
    }
    .glitch-effect:hover::before {
        left: 2px;
        text-shadow: -2px 0 var(--glow-color-2);
        animation: glitch-anim-1 0.8s infinite linear alternate-reverse;
    }
    .glitch-effect:hover::after {
        left: -2px;
        text-shadow: -2px 0 var(--glow-color-1);
        animation: glitch-anim-2 0.8s infinite linear alternate-reverse;
    }
    @keyframes glitch-anim-1 {
        0% { clip-path: inset(80% 0 0 0); }
        20% { clip-path: inset(30% 0 50% 0); }
        40% { clip-path: inset(70% 0 10% 0); }
        60% { clip-path: inset(10% 0 70% 0); }
        80% { clip-path: inset(50% 0 30% 0); }
        100% { clip-path: inset(0 0 80% 0); }
    }
    @keyframes glitch-anim-2 {
        0% { clip-path: inset(10% 0 70% 0); }
        20% { clip-path: inset(50% 0 30% 0); }
        40% { clip-path: inset(0 0 80% 0); }
        60% { clip-path: inset(80% 0 0 0); }
        80% { clip-path: inset(30% 0 50% 0); }
        100% { clip-path: inset(70% 0 10% 0); }
    }
    /* Ensure text is visible for glitch effect */
    .glitch-effect span {
        position: relative;
        z-index: 2;
    }


    /* --- Modal Sections --- */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.7);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        z-index: 1500;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 1rem;
        box-sizing: border-box;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease; /* Adjusted transition for fade */
    }
    .light-theme .modal-overlay {
        background: rgba(255,255,255,0.1);
    }
    .modal-overlay.active {
        opacity: 1;
        visibility: visible;
    }
    .modal-content {
        background: var(--card-bg);
        backdrop-filter: blur(15px);
        -webkit-backdrop-filter: blur(15px);
        border-radius: 16px;
        border: 1px solid var(--card-border);
        box-shadow: 0 8px 32px 0 var(--card-shadow);
        padding: 0; /* Changed padding to 0 */
        width: 100%;
        max-width: 600px;
        max-height: 90vh;
        overflow: hidden; /* Changed to hidden */
        transform: scale(0.95); /* Start slightly smaller for subtle zoom */
        transition: transform 0.3s ease, background 0.4s ease, border-color 0.4s ease; /* Adjusted transition */
        position: relative;
        display: flex; /* Added for layout */
        flex-direction: column; /* Added for layout */
    }
    .modal-overlay.active .modal-content {
        transform: scale(1);
    }
    .modal-header { /* New class for modal headers */
      padding: 1rem 1.5rem;
      border-bottom: 1px solid var(--card-border);
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .modal-header h2 {
        margin: 0;
        font-size: 1.8rem;
        background: linear-gradient(90deg, var(--glow-color-1), var(--glow-color-2));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }
    .modal-body { /* New class for modal content area */
      padding: 1.5rem;
      overflow-y: auto;
      flex-grow: 1;
    }
    .modal-body p {
        color: var(--dim-text-color);
        line-height: 1.6;
    }
    .close-modal {
        position: absolute;
        top: 1rem;
        right: 1rem;
        cursor: pointer;
        color: var(--dim-text-color);
        transition: color 0.3s, transform 0.3s;
        z-index: 10;
    }
    .close-modal:hover {
        color: var(--text-color);
        transform: rotate(90deg);
    }
    
    /* --- Custom Scrollbar --- */
    .modal-body::-webkit-scrollbar, #chatbot-display::-webkit-scrollbar {
        width: 8px;
    }
    .modal-body::-webkit-scrollbar-track, #chatbot-display::-webkit-scrollbar-track {
        background: rgba(127,127,127,0.1);
        border-radius: 4px;
    }
    .modal-body::-webkit-scrollbar-thumb, #chatbot-display::-webkit-scrollbar-thumb {
        background: rgba(127,127,127,0.3);
        border-radius: 4px;
    }
    .modal-body::-webkit-scrollbar-thumb:hover, #chatbot-display::-webkit-scrollbar-thumb:hover {
        background: rgba(127,127,127,0.5);
    }
    
    /* --- Dynamic Content Styling --- */
    .blog-post, .project-card {
        padding: 1rem;
        border: 1px solid rgba(127,127,127,0.2);
        border-radius: 12px;
        margin-bottom: 1rem;
        background: rgba(0,0,0,0.05);
        text-align: left;
        color: var(--text-color); /* Ensure text is visible */
    }
    .blog-post h3, .project-card h3 {
        margin: 0 0 0.25rem 0;
        color: var(--glow-color-1);
    }
    .blog-post .date {
        font-size: 0.8rem;
        color: #888;
        margin-bottom: 0.5rem;
    }
    .blog-post p, .project-card p {
        color: var(--dim-text-color); /* Ensure text is visible */
    }
    .light-theme .blog-post p, .light-theme .project-card p {
        color: var(--text-color);
    }
    .project-card a {
        color: var(--glow-color-2);
        text-decoration: none;
    }
    .project-card .stats {
        display: flex;
        gap: 1rem;
        font-size: 0.9rem;
        margin-top: 1rem;
        color: var(--dim-text-color);
    }
    /* New styles for AI summary button */
    .project-card .ai-summary-btn {
        background: rgba(127, 127, 127, 0.1);
        border: 1px solid rgba(127, 127, 127, 0.2);
        color: var(--dim-text-color);
        font-size: 0.8rem;
        padding: 0.4rem 0.8rem;
        border-radius: 8px;
        cursor: pointer;
        margin-top: 0.75rem;
        transition: all 0.2s ease;
        display: inline-flex; /* Use flex to align icon and text */
        align-items: center;
        gap: 5px;
    }
    .project-card .ai-summary-btn:hover {
        background: rgba(127, 127, 127, 0.2);
        color: var(--text-color);
        border-color: var(--glow-color-1);
        transform: translateY(-2px);
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .project-card .ai-summary-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
    .project-card .ai-summary-btn i {
        width: 16px;
        height: 16px;
        stroke: currentColor; /* Inherit color from parent */
        margin-right: 0; /* Remove default margin */
    }
    /* Styles for AI Project Idea section */
    #ai-project-idea-output {
        background: rgba(0,0,0,0.1);
        border: 1px solid var(--card-border);
        border-radius: 12px;
        padding: 1rem;
        margin-top: 1.5rem;
        text-align: left;
        display: none; /* Hidden by default */
        flex-direction: column;
        gap: 0.5rem;
    }
    #ai-project-idea-output.active {
        display: flex;
    }
    #ai-project-idea-output h3 {
        margin: 0;
        color: var(--glow-color-2);
        font-size: 1.1rem;
    }
    #ai-project-idea-output p {
        margin: 0;
        font-size: 0.9rem;
        color: var(--dim-text-color);
    }
    /* NEW: AI Feature Suggestions styling */
    .ai-feature-suggestions {
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid var(--card-border);
    }
    .ai-feature-suggestions h4 {
        margin: 0 0 0.5rem 0;
        font-size: 0.9rem;
        color: var(--glow-color-2);
    }
    .ai-feature-suggestions ul {
        padding-left: 1.2rem;
        margin: 0;
        font-size: 0.9rem;
        color: var(--dim-text-color);
    }


    /* Generative Art Modal Specific Styles */
    #generative-art-modal .modal-content {
        max-width: 90vw;
        max-height: 90vh;
        display: flex;
        flex-direction: column;
    }
    #generative-art-canvas {
        flex-grow: 1;
        width: 100%;
        min-height: 200px;
        background-color: #000;
        border-radius: 8px;
        margin-bottom: 1rem;
    }
    #generative-art-controls {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center;
        align-items: center;
        padding: 0.5rem 0;
        background: rgba(0,0,0,0.1);
        border-radius: 12px;
        border: 1px solid var(--card-border);
    }
    #generative-art-controls button {
        background: rgba(127, 127, 127, 0.1);
        border: 1px solid rgba(127, 127, 127, 0.2);
        color: var(--text-color);
        padding: 0.5rem 1rem;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
        display: inline-flex;
        align-items: center;
        gap: 5px;
    }
    #generative-art-controls button:hover {
        background: rgba(127, 127, 127, 0.2);
        border-color: var(--glow-color-1);
        box-shadow: 0 0 10px var(--glow-color-1);
    }
    #generative-art-controls button i {
        width: 18px;
        height: 18px;
        stroke: currentColor;
    }
    #generative-art-controls .control-group {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 5px;
        padding: 0 10px;
    }
    #generative-art-controls label {
        font-size: 0.8rem;
        color: var(--dim-text-color);
    }
    #generative-art-controls input[type="range"] {
        width: 80px;
        -webkit-appearance: none; /* Override default look */
        height: 4px;
        background: var(--card-border);
        border-radius: 5px;
        outline: none;
        opacity: 0.7;
        transition: opacity .2s;
    }
    #generative-art-controls input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 14px;
        height: 14px;
        border-radius: 50%;
        background: var(--glow-color-1);
        cursor: pointer;
        box-shadow: 0 0 5px var(--glow-color-1);
    }
    #generative-art-controls input[type="range"]::-moz-range-thumb {
        width: 14px;
        height: 14px;
        border-radius: 50%;
        background: var(--glow-color-1);
        cursor: pointer;
        box-shadow: 0 0 5px var(--glow-color-1);
    }


    /* --- Chatbot Modal Styles (ENHANCED) --- */
    #chatbot-modal .modal-content {
        max-width: 500px;
        height: 85vh; /* Fixed height */
        max-height: 700px;
        padding: 0;
    }
    .chatbot-header {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 1rem 1.5rem;
        border-bottom: 1px solid var(--card-border);
        flex-shrink: 0;
    }
    .chatbot-header h2 {
        margin: 0;
        font-size: 1.5rem;
        background: none;
        -webkit-background-clip: unset;
        -webkit-text-fill-color: unset;
        color: var(--text-color);
    }
    .chatbot-header i {
        color: var(--glow-color-1);
    }
    #chatbot-speech-toggle {
        background: none; border: none; cursor: pointer;
        color: var(--dim-text-color);
        margin-left: auto; padding: 0.25rem;
        transition: color 0.2s;
    }
    #chatbot-speech-toggle.active { color: var(--glow-color-1); }
    #chatbot-display {
        flex-grow: 1;
        overflow-y: auto;
        padding: 1rem;
        background: rgba(0,0,0,0.1);
        display: flex;
        flex-direction: column;
        gap: 1rem; /* Increased gap */
    }
    .chat-message {
        padding: 0.75rem 1rem;
        border-radius: 18px;
        max-width: 85%;
        word-wrap: break-word;
        line-height: 1.5;
        position: relative;
    }
    .chat-message.user {
        background: var(--glow-color-1);
        color: #000;
        align-self: flex-end;
        border-bottom-right-radius: 4px;
    }
    .chat-message.ai {
        background: rgba(127,127,127,0.15);
        color: var(--text-color);
        border: 1px solid var(--card-border);
        align-self: flex-start;
        border-bottom-left-radius: 4px;
    }
    /* Message bubble tails */
    .chat-message.ai::before, .chat-message.user::before {
        content: '';
        position: absolute;
        bottom: 0;
        width: 0;
        height: 0;
        border: 10px solid transparent;
    }
    .chat-message.ai::before {
        left: -10px;
        border-right-color: var(--card-border);
        border-right-width: 7px;
    }
    .light-theme .chat-message.ai::before {
      border-right-color: var(--card-border);
    }
    .chat-message.user::before {
        right: -7px;
        border-left-color: var(--glow-color-1);
    }
    /* Chatbot Markdown Styling */
    .chat-message p { margin: 0 0 0.5rem 0; color: inherit; }
    .chat-message p:last-child { margin-bottom: 0; }
    .chat-message pre {
        background: rgba(0,0,0,0.3);
        border: 1px solid var(--card-border);
        border-radius: 8px;
        padding: 1rem;
        margin: 0.5rem 0;
        font-family: 'Fira Code', monospace;
        font-size: 0.9rem;
        white-space: pre-wrap;
        word-wrap: break-word;
        position: relative;
    }
    .chat-message code {
        font-family: 'Fira Code', monospace;
        background: rgba(127,127,127,0.2);
        padding: 0.1rem 0.3rem;
        border-radius: 4px;
    }
    .chat-message pre code { background: none; padding: 0; }
    .chat-message blockquote {
        border-left: 3px solid var(--glow-color-1);
        padding-left: 1rem;
        margin-left: 0;
        font-style: italic;
        color: var(--dim-text-color);
    }
    .chat-message ul, .chat-message ol { padding-left: 1.5rem; }
    .chat-message a { color: var(--glow-color-2); text-decoration: underline; }
    .copy-code-btn {
        position: absolute;
        top: 0.5rem;
        right: 0.5rem;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: var(--text-color);
        padding: 0.25rem 0.5rem;
        border-radius: 6px;
        cursor: pointer;
        opacity: 0.3;
        transition: opacity 0.2s ease;
        font-size: 0.8rem;
    }
    .chat-message pre:hover .copy-code-btn { opacity: 1; }
    #chatbot-thinking-indicator {
        font-style: italic;
        color: var(--dim-text-color);
        padding: 0 1.5rem 0.5rem;
        flex-shrink: 0;
    }
    .chat-input-container {
        display: flex;
        gap: 0.5rem;
        padding: 1rem 1.5rem;
        border-top: 1px solid var(--card-border);
        flex-shrink: 0;
    }
    #chatbot-input {
        flex-grow: 1;
        padding: 0.75rem;
        border-radius: 8px;
        border: 1px solid var(--card-border);
        background: rgba(0,0,0,0.1);
        color: var(--text-color);
        outline: none;
    }
    #chatbot-input:focus { border-color: var(--glow-color-1); }
    #chatbot-send-btn, #chatbot-clear-btn, #chatbot-mic-btn {
        background: var(--glow-color-2);
        color: #fff;
        border: none;
        padding: 0.75rem;
        border-radius: 8px;
        cursor: pointer;
        transition: background 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    #chatbot-send-btn:hover, #chatbot-clear-btn:hover, #chatbot-mic-btn:hover { background: var(--glow-color-1); }
    #chatbot-mic-btn.listening {
        background: var(--error-color);
        animation: pulse-red 1.5s infinite;
    }
    @keyframes pulse-red {
        0% { box-shadow: 0 0 0 0 rgba(255, 85, 85, 0.7); }
        70% { box-shadow: 0 0 0 10px rgba(255, 85, 85, 0); }
        100% { box-shadow: 0 0 0 0 rgba(255, 85, 85, 0); }
    }
    /* Suggested Actions */
    #suggested-actions-container {
        padding: 0 1rem 1rem;
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        justify-content: center;
    }
    .suggested-action-btn {
        background: rgba(127,127,127,0.1);
        border: 1px solid var(--card-border);
        color: var(--dim-text-color);
        padding: 0.5rem 0.8rem;
        border-radius: 12px;
        cursor: pointer;
        font-size: 0.85rem;
        transition: all 0.2s ease;
    }
    .suggested-action-btn:hover {
        background: rgba(127,127,127,0.2);
        color: var(--text-color);
        border-color: var(--glow-color-1);
    }


    /* --- Command Palette --- */
    #command-palette-overlay { z-index: 2500; }
    .command-palette {
        width: 100%;
        max-width: 550px;
        max-height: 50vh;
        display: flex;
        flex-direction: column;
    }
    .command-palette input {
        width: 100%;
        padding: 1rem;
        font-size: 1.1rem;
        background: rgba(127,127,127,0.1);
        border: 1px solid var(--card-border);
        color: var(--text-color);
        border-radius: 12px 12px 0 0;
        outline: none;
    }
    .command-list { list-style: none; padding: 0; margin: 0; overflow-y: auto; border-radius: 0 0 12px 12px; }
    .command-item {
        padding: 0.75rem 1rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 10px;
        border-top: 1px solid var(--card-border);
    }
    .command-item:hover, .command-item.selected { background: rgba(127, 127, 127, 0.2); }
    .light-theme .command-item:hover, .light-theme .command-item.selected { background: rgba(0,0,0,0.1); }
    .command-item i { color: var(--dim-text-color); }

    /* --- CLI Contact Form --- */
    .terminal {
        --terminal-bg: rgba(0,0,0,0.1);
        --terminal-text: var(--text-color);
        --terminal-prompt: var(--glow-color-1);
        --terminal-response: #aaa;
        --terminal-error: var(--error-color);
        --terminal-success: #50fa7b; /* Direct color for success */
        --terminal-filename: var(--glow-color-2);
    }
    .light-theme .terminal {
        --terminal-response: #495057;
    }

    #cli-output {
        height: 100%; /* Fill modal body */
        overflow-y: auto;
        font-family: 'Fira Code', monospace;
        font-size: 0.9rem;
        background: var(--terminal-bg);
        color: var(--terminal-text);
        transition: background 0.3s, color 0.3s;
    }

    #cli-output .cli-line { margin-bottom: 5px; white-space: pre-wrap; word-break: break-all; }
    #cli-output .cli-prompt { color: var(--terminal-prompt); }
    #cli-output .cli-response { color: var(--terminal-response); }
    #cli-output .cli-error { color: var(--terminal-error); }
    #cli-output .cli-success { color: var(--terminal-success); }
    #cli-output .cli-filename { color: var(--terminal-filename); }
    
    .cli-input-container { display: flex; margin-top: 10px; align-items: center; }
    .cli-prompt-text { font-family: 'Fira Code', monospace; color: var(--terminal-prompt); margin-right: 5px; white-space: pre; }
    #cli-input {
        flex-grow: 1;
        background: transparent;
        border: none;
        color: var(--text-color);
        font-family: 'Fira Code', monospace;
        outline: none;
    }
    @keyframes blink {
      50% { opacity: 0; }
    }
    .blinking-cursor {
        background: var(--terminal-prompt);
        width: 8px;
        height: 1.2em;
        animation: blink 1s step-end infinite;
    }

    /* Custom Context Menu */
    #custom-context-menu {
        position: fixed;
        background: var(--card-bg);
        backdrop-filter: blur(10px);
        border-radius: 8px;
        border: 1px solid var(--card-border);
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        padding: 0.5rem 0;
        z-index: 3500;
        display: none;
        flex-direction: column;
        min-width: 180px;
    }
    #custom-context-menu .context-menu-item {
        padding: 0.75rem 1rem;
        cursor: pointer;
        color: var(--text-color);
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        gap: 10px;
        transition: background 0.2s ease;
    }
    #custom-context-menu .context-menu-item:hover {
        background: rgba(127,127,127,0.15);
    }
    #custom-context-menu .context-menu-item i {
        width: 18px;
        height: 18px;
        stroke: var(--dim-text-color);
    }


    /* --- Footer & Misc --- */
    footer {
      position: relative;
      z-index: 1;
      margin-top: auto;
      padding: 1.5rem;
      font-size: 0.9rem;
      text-align: center;
      color: #888;
      background: rgba(0,0,0,0.05);
      display: flex;
      flex-direction: column;
      gap: 1rem;
      align-items: center;
    }
    
    #toast {
        position: fixed;
        bottom: -100px;
        left: 50%;
        transform: translateX(-50%);
        background: #333;
        color: #fff;
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        transition: bottom 0.5s ease;
        z-index: 3000;
    }
    #toast.show {
        bottom: 2rem;
    }

    .cookie-banner {
      position: fixed;
      left: 1rem; right: 1rem; bottom: -100%;
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      color: var(--text-color);
      padding: 1rem 1.5rem;
      border-radius: 12px;
      border: 1px solid var(--card-border);
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      text-align: center;
      z-index: 2000;
      transition: bottom 0.5s ease-in-out;
      max-width: 500px;
      margin: 0 auto 1rem;
    }
    .cookie-banner.show { bottom: 0; }
    .cookie-banner button {
      background: linear-gradient(90deg, var(--glow-color-1), var(--glow-color-2));
      border: none; padding: 0.6rem 1.1rem; color: #fff; font-weight: bold;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(127,127,127, 0.4);
      transition: all 0.3s;
    }
    .light-theme .cookie-banner button { color: #000; }
    .cookie-banner button:hover { transform: scale(1.05); }

    @media (min-width: 640px) {
        .cookie-banner {
            flex-direction: row;
            justify-content: space-between;
            text-align: left;
        }
        footer {
            flex-direction: row;
            justify-content: space-between;
        }
    }

  </style>
</head>
<body>

  <div id="preloader"><i data-feather="loader" class="spin"></i></div>

  <!-- Header -->
  <header class="site-header">
    <a href="/" class="header-logo" aria-label="Judson Saji - Home">Judson Saji</a> <!-- Branding is now a link -->
    <nav class="site-nav" id="desktop-nav"> <!-- Added ID for desktop nav -->
      <a data-modal="about" aria-label="About">About</a>
      <a data-modal="projects" aria-label="Projects">Projects</a>
      <a data-modal="chatbot" aria-label="Chatbot AI">Chatbot AI</a> <!-- Changed from Blog to Chatbot -->
      <a data-modal="generative-art" aria-label="Generative Art">Generative Art</a>
      <a data-modal="contact" aria-label="Contact">Contact</a>
    </nav>
    <button id="hamburger-btn" aria-label="Open navigation menu">
        <i data-feather="menu"></i>
    </button>
  </header>

  <!-- Main Navigation Drawer (Mobile) -->
  <div id="main-nav-drawer">
      <div class="drawer-header"> <!-- NEW: Drawer Header -->
          <a href="/" class="header-logo" aria-label="Judson Saji - Home">Judson Saji</a>
          <button id="drawer-close-btn" aria-label="Close navigation menu">
              <i data-feather="x"></i>
          </button>
      </div>
      <div class="drawer-nav-links">
          <!-- Links will be dynamically added here by JS -->
      </div>
  </div>
  <div id="drawer-backdrop"></div> <!-- Backdrop for the drawer -->


  <!-- Canvas Backgrounds -->
  <canvas id="aurora-canvas" class="background-canvas"></canvas>
  <canvas id="day-canvas" class="background-canvas"></canvas>
  <canvas id="konami-canvas" class="background-canvas"></canvas>
  <canvas id="cursor-trail-canvas"></canvas>


  <!-- Main Content -->
  <div class="centerbox">
    <div class="card animate-on-scroll" id="profile-card">
      <img class="profile-img" src="https://firebasestorage.googleapis.com/v0/b/crnn-b7d8f.appspot.com/o/files%2FIMG_20250717_215454_617-modified.png?alt=media&token=bea1f0dd-abf1-4cfb-8a83-0d3b603d3fde" alt="Judson Saji Profile Picture" loading="lazy"
      onerror="this.onerror=null;this.src='https://placehold.co/110x110/161822/ffffff?text=JS';"/>
      <div class="profile-name">Judson Saji</div>
      <div id="greeting" class="profile-greeting"></div>
      <div class="profile-tagline">ExPoet, ExMinimalist, ExThinker, NowCreator</div>

      <div class="status-widget animate-on-scroll slide-left">
        <span id="time-widget"><i data-feather="clock"></i> --:-- --</span>
        <span id="weather-widget"><i data-feather="loader" class="spin"></i></span>
        <span id="github-widget"><i data-feather="github"></i> --</span>
      </div>

      <!-- Now Playing Widget -->
      <div id="now-playing-widget" class="animate-on-scroll slide-right">
        <img class="album-art" src="https://placehold.co/64x64/333333/ffffff?text=Loading..." alt="Album Art" loading="lazy" />
        <div class="track-info">
          <div class="track-name">Loading...</div>
          <div class="artist-name"></div>
        </div>
      </div>

      <div class="btn-group">
        <a class="ambient-btn glitch-effect" data-text="Twitter" href="https://twitter.com/greyvrita" target="_blank" aria-label="Twitter"><i data-feather="twitter"></i><span>Twitter</span></a>
        <a class="ambient-btn glitch-effect" data-text="GitHub" href="https://github.com/Judson-web" target="_blank" aria-label="GitHub"><i data-feather="github"></i><span>GitHub</span></a>
        <a class="ambient-btn glitch-effect" data-text="Instagram" href="https://www.instagram.com/judson_saji" target="_blank" aria-label="Instagram"><i data-feather="instagram"></i><span>Instagram</span></a>
        <a class="ambient-btn glitch-effect" data-text="Email" data-modal="contact" aria-label="Email"><i data-feather="mail"></i><span>Email</span></a>
      </div>
    </div>
  </div>

  <!-- Modal Sections -->
  <div id="about-modal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="about-modal-title">
    <div class="modal-content">
      <i data-feather="x" class="close-modal" aria-label="Close About modal"></i>
      <div class="modal-header">
        <h2 id="about-modal-title">About Me</h2>
      </div>
      <div class="modal-body">
        <p>I'm a creator driven by the fusion of technology and art. My background isn't linear; it's a path woven through poetry, the discipline of minimalism, and a deep-seated love for analytical thought. Today, these threads combine in my work as a creative developer.</p>
        <p>My focus is on generative art, interactive design, and building digital experiences that feel both intelligent and human. This space is my digital sketchbook and a reflection of my ongoing projects. I'm currently exploring how to tell better stories with code. Welcome.</p>
      </div>
    </div>
  </div>
   <div id="projects-modal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="projects-modal-title">
    <div class="modal-content">
      <i data-feather="x" class="close-modal" aria-label="Close Projects modal"></i>
      <div class="modal-header">
        <h2 id="projects-modal-title">GitHub Projects</h2>
      </div>
      <div class="modal-body">
        <button id="generate-project-idea-btn" class="ambient-btn glitch-effect" data-text="Generate a Project Idea" aria-label="Generate a new project idea with AI" style="margin-bottom: 1rem; width: 100%;">
            <i data-feather="cpu" style="width: 18px; height: 18px; stroke: currentColor; margin-right: 5px;"></i>
            <span>✨ Generate a Project Idea</span>
        </button>
        <div id="ai-project-idea-output">
            <h3 id="ai-project-idea-title"></h3>
            <p id="ai-project-idea-concept"></p>
        </div>
        <div id="projects-list"></div>
      </div>
    </div>
  </div>
  <div id="generative-art-modal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="generative-art-modal-title">
    <div class="modal-content">
      <i data-feather="x" class="close-modal" aria-label="Close Generative Art modal"></i>
      <div class="modal-header">
        <h2 id="generative-art-modal-title">Generative Art Lab</h2>
      </div>
      <div class="modal-body">
        <p>Explore a live generative art piece. It reacts to your mouse movement!</p>
        <canvas id="generative-art-canvas"></canvas>
        <div id="generative-art-controls">
          <button id="reset-art-btn" aria-label="Reset generative art to default"><i data-feather="refresh-cw"></i> Reset</button>
          <button id="change-particle-color-btn" aria-label="Change particle color"><i data-feather="droplet"></i> Particle Color</button>
          <button id="change-bg-color-btn" aria-label="Change background color"><i data-feather="square"></i> Background Color</button>
          <button id="toggle-lines-btn" aria-label="Toggle connection lines"><i data-feather="link-2"></i> Lines: ON</button>
          <button id="pause-play-btn" aria-label="Pause or play animation"><i data-feather="pause"></i> Pause</button>
          <button id="ai-generate-palette-btn" aria-label="Ask AI to generate a new color palette"><i data-feather="cpu"></i> ✨ AI Palette</button>

          <div class="control-group">
              <label for="particle-count-slider">Count</label>
              <input type="range" id="particle-count-slider" min="50" max="300" value="100" aria-label="Adjust particle count">
          </div>
          <div class="control-group">
              <label for="particle-size-slider">Size</label>
              <input type="range" id="particle-size-slider" min="0.5" max="5" step="0.1" value="2" aria-label="Adjust particle size">
          </div>
          <div class="control-group">
              <label for="particle-speed-slider">Speed</label>
              <input type="range" id="particle-speed-slider" min="0.1" max="5" step="0.1" value="2" aria-label="Adjust particle speed">
          </div>
          <div class="control-group">
              <label for="repulsion-strength-slider">Repulsion</label>
              <input type="range" id="repulsion-strength-slider" min="0.01" max="1" step="0.01" value="0.5" aria-label="Adjust mouse repulsion strength">
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="chatbot-modal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="chatbot-modal-title">
    <div class="modal-content">
      <i data-feather="x" class="close-modal" aria-label="Close Chatbot modal"></i>
      <div class="chatbot-header">
        <i data-feather="cpu"></i>
        <h2 id="chatbot-modal-title">Judson AI</h2>
        <button id="chatbot-speech-toggle" title="Toggle speech output">
            <i data-feather="volume-2"></i>
        </button>
      </div>
      <div id="chatbot-display">
        <!-- Chat history will be rendered here by JS -->
      </div>
      <div id="suggested-actions-container">
        <!-- Suggested actions will be rendered here by JS -->
      </div>
      <div id="chatbot-thinking-indicator" style="display:none;">AI is thinking...</div>
      <div class="chat-input-container">
        <input type="text" id="chatbot-input" placeholder="Ask or type..." aria-label="Chatbot message input">
        <button id="chatbot-mic-btn" title="Use voice input"><i data-feather="mic"></i></button>
        <button id="chatbot-send-btn" aria-label="Send message"><i data-feather="send"></i></button>
        <button id="chatbot-clear-btn" aria-label="Clear chat history"><i data-feather="trash-2"></i></button>
      </div>
    </div>
  </div>
  <div id="contact-modal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="contact-modal-title">
    <div class="modal-content terminal" id="terminal-container">
        <i data-feather="x" class="close-modal" aria-label="Close Contact Terminal modal"></i>
        <div class="modal-header">
          <h2 id="contact-modal-title">Contact Terminal</h2>
        </div>
        <div class="modal-body" style="padding: 10px; display: flex; flex-direction: column;">
          <div id="cli-output" role="log" aria-live="polite" aria-atomic="false"></div>
          <div class="cli-input-container">
              <span id="cli-prompt-text">></span>
              <input type="text" id="cli-input" autofocus autocomplete="off" aria-label="Terminal command input">
              <div class="blinking-cursor"></div>
          </div>
        </div>
    </div>
  </div>

  <!-- Command Palette -->
  <div id="command-palette-overlay" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="command-palette-title">
      <div class="modal-content command-palette">
          <h2 id="command-palette-title" style="display:none;">Command Palette</h2>
          <input type="text" id="command-input" placeholder="Type a command or search..." aria-label="Command search input">
          <ul id="command-list" class="command-list" role="listbox"></ul>
      </div>
  </div>

  <!-- Custom Right-Click Context Menu -->
  <div id="custom-context-menu" role="menu">
      <div class="context-menu-item" data-action="toggleTheme" role="menuitem"><i data-feather="moon"></i> Change Theme</div>
      <div class="context-menu-item" data-action="openCli" role="menuitem"><i data-feather="terminal"></i> Open CLI</div>
      <div class="context-menu-item" data-action="copyUrl" role="menuitem"><i data-feather="copy"></i> Copy Page URL</div>
  </div>


  <!-- Footer -->
  <footer>
    <span>&copy; 2025 Judson Saji.</span>
    <span>Press Ctrl+K to navigate.</span>
  </footer>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <!-- Cookie Consent -->
  <div class="cookie-banner" id="cookie-banner" role="dialog" aria-live="polite" aria-label="Cookie consent banner">
    <span>
      This site uses cookies for performance and experience. 
      <a href="#" style="color:#9df; text-decoration:underline;">Learn more</a>
    </span>
    <button id="cookie-btn" aria-label="Accept cookies">Accept</button>
  </div>

  <script>
    // --- INITIAL SETUP & HELPERS ---
    // ... (omitted for brevity, no changes)

    // --- CHATBOT AI LOGIC (AGENT w/ TOOLS, SPEECH, STREAMING) ---
    const chatbot = {
        // ... (properties: elements, history, state flags)
        isInitialized: false,
        speechEnabled: false,
        isListening: false,
        speechRecognition: null,

        init() {
            if (this.isInitialized) return;
            
            // ... (get all DOM elements)
            this.micButton = document.getElementById('chatbot-mic-btn');
            this.speechToggleButton = document.getElementById('chatbot-speech-toggle');

            this.loadHistory();
            this.renderAllMessages();
            this.setupEventHandlers();
            this.setupSpeech();

            this.inputElement.focus();
            this.isInitialized = true;
        },

        setupEventHandlers() {
            this.sendButton.onclick = () => this.sendMessage();
            this.inputElement.onkeydown = (e) => { /* ... */ };
            this.clearButton.onclick = () => this.clearChat();
            this.micButton.onclick = () => this.toggleVoiceInput();
            this.speechToggleButton.onclick = () => this.toggleSpeechOutput();
        },

        // ... (renderAllMessages, _createMessageElement with copy fix)
        _createMessageElement(sender, text) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender}`;
            // Use a temporary element to parse markdown to avoid security risks of direct innerHTML
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = marked.parse(text || "");
            messageDiv.appendChild(tempDiv);
            
            this.displayElement.appendChild(messageDiv);

            if (sender === 'ai') {
                messageDiv.querySelectorAll('pre code').forEach(block => {
                    const preElement = block.parentElement;
                    const copyButton = document.createElement('button');
                    copyButton.innerHTML = '<i data-feather="copy"></i>';
                    copyButton.className = 'copy-code-btn';
                    copyButton.title = 'Copy code';
                    
                    copyButton.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const codeToCopy = block.textContent;
                        // **BUG FIX**: Using execCommand for better iFrame compatibility
                        const textArea = document.createElement("textarea");
                        textArea.value = codeToCopy;
                        document.body.appendChild(textArea);
                        textArea.focus();
                        textArea.select();
                        try {
                            document.execCommand('copy');
                            showToast('Code copied to clipboard!');
                            playSound('E5', 'sine', '32n');
                        } catch (err) {
                            showToast('Failed to copy code.');
                            console.error('Fallback: Oops, unable to copy', err);
                        }
                        document.body.removeChild(textArea);
                    });
                    preElement.appendChild(copyButton);
                });
            }
            return messageDiv;
        },


        // ... (renderSuggestedActions)

        async sendMessage(isVoiceInput = false) {
            let userMessage = this.inputElement.value.trim();
            if (!userMessage || this.isThinking) return;

            // Personalization check
            if (this.isAwaitingName) {
                localStorage.setItem('chatbotUserName', userMessage);
                this.isAwaitingName = false;
                this.addNewMessage('user', userMessage);
                this.chatHistory.push({ role: "user", parts: [{ text: userMessage }] });
                this.saveHistory();
                this.inputElement.value = '';
                this.showThinking(true);
                const welcomeText = `Nice to meet you, ${userMessage}! How can I help you today?`;
                await this._streamResponse(welcomeText);
                this.renderSuggestedActions(); // Show suggestions after name is given
                return;
            }

            this.suggestedActionsContainer.innerHTML = '';
            if (!isVoiceInput) {
                this.addNewMessage('user', userMessage);
            }
            this.chatHistory.push({ role: "user", parts: [{ text: userMessage }] });
            this.saveHistory();
            
            this.inputElement.value = '';
            this.showThinking(true);

            await this.runConversation();
        },

        async runConversation() {
            try {
                const userName = localStorage.getItem('chatbotUserName') || '';
                const aiResponse = await fetch('/.netlify/functions/ask-gemini', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ history: this.chatHistory, userName: userName }),
                });

                if (!aiResponse.ok) throw new Error(await aiResponse.text());
                
                const data = await aiResponse.json();
                const modelResponse = data.response;

                if (modelResponse.parts[0].functionCall) {
                    await this.handleFunctionCall(modelResponse);
                } else {
                    const textResponse = modelResponse.parts[0].text;
                    await this._streamResponse(textResponse);
                }

            } catch (error) {
                await this._streamResponse(`Error: ${error.message}`);
            } finally {
                this.showThinking(false);
                this.inputElement.focus();
            }
        },

        async handleFunctionCall(modelResponse) {
            const functionCall = modelResponse.parts[0].functionCall;
            this.chatHistory.push(modelResponse); // Log the AI's decision to call a tool

            let toolResult;
            const isFrontendTool = ['set_theme', 'navigate_to', 'control_generative_art'].includes(functionCall.name);

            if (isFrontendTool) {
                toolResult = this.executeFrontendTool(functionCall.name, functionCall.args);
            } else {
                const toolResponse = await fetch('/.netlify/functions/chatbot-tools', {
                    method: 'POST',
                    body: JSON.stringify({ toolName: functionCall.name, args: functionCall.args })
                });
                toolResult = await toolResponse.json();
            }
            
            this.chatHistory.push({
                role: "tool",
                parts: [{ functionResponse: { name: functionCall.name, response: toolResult } }]
            });

            await this.runConversation(); // Continue conversation with tool result
        },

        executeFrontendTool(toolName, args) {
            try {
                switch (toolName) {
                    case 'set_theme':
                        applyTheme(args.theme);
                        return { success: true, message: `Theme changed to ${args.theme}` };
                    case 'navigate_to':
                        openModal(args.section);
                        return { success: true, message: `Navigating to ${args.section}` };
                    case 'control_generative_art':
                        // This requires the generative art logic to be accessible
                        if (typeof window.controlGenerativeArt === 'function') {
                            window.controlGenerativeArt(args);
                            return { success: true, message: `Art canvas updated.` };
                        }
                        return { success: false, message: `Art canvas controller not found.` };
                }
            } catch (e) {
                return { success: false, message: `Error executing tool: ${e.message}` };
            }
        },

        async _streamResponse(text) {
            const messageDiv = this._createMessageElement('ai', '');
            const tempDiv = messageDiv.querySelector('div');
            
            this.chatHistory.push({ role: "model", parts: [{ text: text }] });
            this.saveHistory();

            if (this.speechEnabled) this.speak(text);

            const words = text.split(' ');
            for (let i = 0; i < words.length; i++) {
                tempDiv.innerHTML = marked.parse(words.slice(0, i + 1).join(' '));
                this.displayElement.scrollTop = this.displayElement.scrollHeight;
                await new Promise(resolve => setTimeout(resolve, 50)); // Typing speed
            }
            feather.replace(); // Re-apply icons after streaming is done
        },

        // ... (saveHistory, loadHistory, personalization logic)
        loadHistory() {
            // ...
            const userName = localStorage.getItem('chatbotUserName');
            this.isAwaitingName = !userName;
        },

        // --- SPEECH METHODS ---
        setupSpeech() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (SpeechRecognition) {
                this.speechRecognition = new SpeechRecognition();
                this.speechRecognition.continuous = false;
                this.speechRecognition.lang = 'en-US';
                this.speechRecognition.interimResults = false;

                this.speechRecognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    this.inputElement.value = transcript;
                    this.sendMessage(true); // true indicates from voice
                };
                this.speechRecognition.onerror = (event) => {
                    console.error('Speech recognition error:', event.error);
                    showToast(`Voice Error: ${event.error}`);
                };
                this.speechRecognition.onend = () => {
                    this.isListening = false;
                    this.micButton.classList.remove('listening');
                };
            } else {
                this.micButton.style.display = 'none'; // Hide if not supported
            }
        },

        toggleVoiceInput() {
            if (!this.speechRecognition) return;
            if (this.isListening) {
                this.speechRecognition.stop();
            } else {
                this.speechRecognition.start();
                this.isListening = true;
                this.micButton.classList.add('listening');
            }
        },

        toggleSpeechOutput() {
            this.speechEnabled = !this.speechEnabled;
            this.speechToggleButton.classList.toggle('active', this.speechEnabled);
            const icon = this.speechEnabled ? 'volume-2' : 'volume-x';
            this.speechToggleButton.innerHTML = `<i data-feather="${icon}"></i>`;
            feather.replace();
            showToast(`Speech output ${this.speechEnabled ? 'enabled' : 'disabled'}.`);
        },

        speak(text) {
            if (!this.speechEnabled || !window.speechSynthesis) return;
            // Clean up markdown for better speech
            const cleanText = text.replace(/```[\s\S]*?```/g, 'Code snippet.')
                                 .replace(/[*_`#]/g, '');
            const utterance = new SpeechSynthesisUtterance(cleanText);
            window.speechSynthesis.speak(utterance);
        }
    };

    // ... (CLI Logic, simplified as requested)

    // Make generative art controls globally accessible for the chatbot tool
    window.controlGenerativeArt = (args) => {
        if (!args) return;
        if (args.action === 'reset') {
            document.getElementById('reset-art-btn')?.click();
            return;
        }
        if (args.property) {
            const slider = document.getElementById(`particle-${args.property}-slider`);
            if (slider) {
                let currentValue = parseFloat(slider.value);
                if (args.action === 'increase') slider.value = currentValue * 1.5;
                if (args.action === 'decrease') slider.value = currentValue * 0.5;
                // Trigger input event to apply change
                slider.dispatchEvent(new Event('input'));
            }
        }
        if (args.color) {
            generativeArtConfig.particleColor = args.color;
        }
    };

    // ... (Full initialization logic)
  </script>
</body>
</html>
